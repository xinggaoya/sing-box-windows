# Sing-Box Windows 多语言支持

## 概述

Sing-Box Windows 项目支持多语言功能，目前支持以下语言：

- 简体中文 (zh-CN) - 默认语言
- 英文 (en-US)
- 日本語 (ja-JP)
- Русский (ru-RU)

用户可以在设置页面中选择应用的显示语言，也可以选择"自动"选项，让应用自动根据系统语言设置选择合适的语言。

## 技术实现

多语言支持基于 vue-i18n 库实现，主要文件和结构如下：

```
src/
└── locales/
    ├── index.ts        # i18n 配置和初始化
    ├── zh-CN.ts        # 中文语言包（默认）
    ├── en-US.ts        # 英文语言包
    ├── ja-JP.ts        # 日文语言包
    └── ru-RU.ts        # 俄文语言包
```

应用状态管理通过 Pinia 的 AppStore 实现，保存用户的语言偏好设置。

## 如何使用

### 在组件中使用翻译

在 Vue 组件中可以通过以下方式使用翻译：

1. 在模板中使用 `$t` 函数：

```vue
<template>
  <div>{{ $t('common.ok') }}</div>
</template>
```

2. 在脚本中使用 `useI18n` 钩子：

```vue
<script setup>
import { useI18n } from 'vue-i18n'

const { t } = useI18n()
console.log(t('common.ok')) // 输出翻译后的文本
</script>
```

### 切换语言

用户可以在设置页面手动切换语言，或者选择"自动"选项让应用自动检测系统语言。

应用会记住用户的语言选择，并在重启后保持该设置。

### 语言回退机制

应用实现了完善的语言回退机制：

1. 首先尝试使用用户选择的语言
2. 如果选择"自动"，则尝试匹配系统语言
3. 如果系统语言不在支持列表中，回退到简体中文
4. 如果翻译键缺失，自动使用中文作为备用

## 翻译覆盖范围

项目包含完整的翻译，覆盖所有功能模块：

### 已翻译的功能模块

1. **通用部分** (common)
   - 按钮文本（确定、取消、保存等）
   - 状态提示（成功、失败、警告等）
   - 通用操作（添加、删除、编辑、复制等）

2. **导航菜单** (nav)
   - 所有页面导航项
   - 快捷键提示

3. **首页** (home)
   - 代理模式卡片
   - 流量统计显示
   - 状态信息

4. **代理管理** (proxy)
   - 节点列表和分组
   - 延迟测试
   - 节点选择和切换

5. **订阅管理** (sub)
   - 订阅列表
   - 添加和编辑订阅
   - 订阅更新状态

6. **规则管理** (rules)
   - 规则列表
   - 规则详情
   - 规则集管理

7. **连接管理** (connections)
   - 活动连接
   - 连接详情
   - 连接历史

8. **日志查看** (logs)
   - 日志级别
   - 日志过滤
   - 日志导出

9. **设置页面** (setting)
   - 基础设置
   - 高级配置（DNS、路由等）
   - 外观设置
   - 更新设置

10. **系统托盘** (tray)
    - 托盘菜单
    - 快捷操作
    - 状态显示

11. **通知消息** (notification)
    - 成功提示
    - 错误信息
    - 警告消息

### 翻译质量保证

- **专业术语一致性**：技术术语在所有语言中保持一致翻译
- **本地化适配**：考虑各语言的表达习惯
- **动态内容处理**：支持带参数的翻译（如计数、时间等）
- **完整性检查**：确保所有翻译键在所有语言中都有对应

## 如何添加新语言

要添加新的语言支持，需要执行以下步骤：

1. 在 `src/locales` 目录下创建新的语言文件，例如 `fr-FR.ts` (法语)：

```typescript
export default {
  common: {
    ok: 'OK',
    cancel: 'Annuler',
    // ... 其他翻译
  },
  // ... 其他分类
}
```

2. 在 `src/locales/index.ts` 中注册新语言：

```typescript
import frFR from './fr-FR'

// 支持的语言列表
export const supportedLocales = [
  { code: 'zh-CN', name: '简体中文' },
  { code: 'en-US', name: 'English' },
  { code: 'ja-JP', name: '日本語' },
  { code: 'ru-RU', name: 'Русский' },
  { code: 'fr-FR', name: 'Français' }, // 添加新语言
]

// 创建i18n实例
const i18n = createI18n({
  // ...
  messages: {
    'zh-CN': zhCN,
    'en-US': enUS,
    'ja-JP': jaJP,
    'ru-RU': ruRU,
    'fr-FR': frFR, // 注册新语言
  },
  // ...
})
```

3. 更新 AppStore 中的 Locale 类型：

```typescript
export type Locale = 'zh-CN' | 'en-US' | 'ja-JP' | 'ru-RU' | 'fr-FR' | 'auto'
```

## 翻译规范

为保持一致性，翻译时请遵循以下规范：

1. 保持翻译的键结构一致，不要添加或删除键
2. 保持翻译的格式一致，特别是带有占位符的文本
3. 翻译应该尊重原文的意思，同时符合目标语言的使用习惯
4. 专有名词和技术术语尽量保持一致的翻译

## 翻译管理工具

### 提取未翻译的键

使用以下脚本来检查缺失的翻译：

```bash
# 创建检查脚本 scripts/check-i18n.js
const fs = require('fs')
const path = require('path')

const locales = ['zh-CN', 'en-US', 'ja-JP', 'ru-RU']
const baseLocale = 'zh-CN'

// 加载语言文件
const loadLocale = (locale) => {
  const filePath = path.join(__dirname, `../src/locales/${locale}.ts`)
  const content = fs.readFileSync(filePath, 'utf8')
  // 简单的解析，实际项目可能需要更复杂的解析
  const match = content.match(/export default\s*({[\s\S]*?})/)
  return match ? eval('(' + match[1] + ')') : {}
}

// 检查缺失的键
const checkMissingKeys = () => {
  const baseTranslations = loadLocale(baseLocale)

  locales.forEach(locale => {
    if (locale === baseLocale) return

    const translations = loadLocale(locale)
    const missingKeys = []

    const checkKeys = (obj, baseObj, prefix = '') => {
      for (const key in baseObj) {
        const fullKey = prefix ? `${prefix}.${key}` : key

        if (!obj[key]) {
          missingKeys.push(fullKey)
        } else if (typeof baseObj[key] === 'object') {
          checkKeys(obj[key], baseObj[key], fullKey)
        }
      }
    }

    checkKeys(translations, baseTranslations)

    if (missingKeys.length > 0) {
      console.log(`\n${locale} 缺失的翻译键：`)
      missingKeys.forEach(key => console.log(`  - ${key}`))
    } else {
      console.log(`\n${locale} 翻译完整！`)
    }
  })
}

checkMissingKeys()
```

### 翻译贡献指南

1. ** Fork 项目**并创建功能分支
2. **翻译新功能**：确保所有新增的翻译键在所有语言文件中都有对应
3. **检查完整性**：运行上述检查脚本确保没有遗漏
4. **本地测试**：切换到对应语言，检查界面显示是否正确
5. **提交 PR**：详细说明翻译内容的修改

### 自动化翻译更新

项目配置了 GitHub Actions 工作流，在 PR 中会自动：

- 检查翻译文件的完整性
- 验证 JSON/YAML 格式是否正确
- 提醒作者更新缺失的翻译

## 语言文件结构

语言文件按功能模块进行组织：

- `common`: 通用翻译，如按钮文本、提示信息等
- `nav`: 导航菜单翻译
- `home`: 首页相关翻译
- `proxy`: 代理管理相关翻译
- `sub`: 订阅管理相关翻译
- `log`: 日志查看相关翻译
- `setting`: 设置页面相关翻译
- `rules`: 规则管理相关翻译
- `connections`: 连接管理相关翻译
- `tray`: 系统托盘相关翻译
- `notification`: 通知相关翻译

添加新功能时，请在相应的分类下添加翻译，或者为新功能创建新的分类。
